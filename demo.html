<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#f8fafc">
    <title>Index of /shared/assets/</title>

    <!-- Google Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- Theme Stylesheet -->
    <link rel="stylesheet" href="style.css">

    <!-- Theme Initialization (before body renders) -->
    <script>
        if (localStorage.getItem('theme') === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
            document.documentElement.classList.add('dark');
        }
    </script>
</head>

<body>
    <div class="fancyui-container">

        <!-- Top Navigation Bar -->
        <nav class="fancyui-nav">
            <div class="fancyui-nav-left">
                <!-- Storage Node Label -->
                <div class="fancyui-node-label">
                    <i data-lucide="database"></i>
                    <span>File Server</span>
                </div>
                <!-- Breadcrumb (will be generated by JS) -->
                <div class="fancyui-breadcrumb" id="fancyui-breadcrumb">
                    <a href="/">root</a>
                </div>
            </div>

            <div class="fancyui-nav-right">
                <!-- Search -->
                <div class="fancyui-search">
                    <i data-lucide="search" class="fancyui-search-icon"></i>
                    <input type="text" id="fancyui-search" class="fancyui-search-input"
                        placeholder="Filter files... (Ctrl+K)" autocomplete="off">
                </div>

                <!-- Theme Toggle -->
                <button class="fancyui-theme-toggle" id="fancyui-theme-toggle" title="Toggle theme">
                    <i data-lucide="sun" class="icon-sun"></i>
                    <i data-lucide="moon" class="icon-moon"></i>
                </button>
            </div>
        </nav>

        <!-- Sorting Controls -->
        <div class="fancyui-sort-bar">
            <span class="fancyui-sort-label">Sort by:</span>
            <button class="fancyui-sort-btn active" data-sort="name">
                <i data-lucide="arrow-up-down"></i>
                Name
            </button>
            <button class="fancyui-sort-btn" data-sort="date">
                <i data-lucide="calendar"></i>
                Date
            </button>
            <button class="fancyui-sort-btn" data-sort="size">
                <i data-lucide="hard-drive"></i>
                Size
            </button>
        </div>

        <!-- File Table Card -->
        <div class="fancyui-card">
            <div class="fancyui-card-scroll">

                <!-- Hidden H1 for breadcrumb generation (this is what fancyindex outputs) -->
                <h1>/shared/assets/</h1>

                <!-- File Table (simulated fancyindex output) -->
                <table>
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Date Modified</th>
                            <th>Size</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><a href="../">Parent Directory</a></td>
                            <td>-</td>
                            <td>-</td>
                        </tr>
                        <tr>
                            <td><a href="Production_Builds/">Production_Builds/</a></td>
                            <td>2024-10-24 14:30</td>
                            <td>-</td>
                        </tr>
                        <tr>
                            <td><a href="Development/">Development/</a></td>
                            <td>2024-10-22 09:15</td>
                            <td>-</td>
                        </tr>
                        <tr>
                            <td><a href="Archives/">Archives/</a></td>
                            <td>2024-10-20 18:00</td>
                            <td>-</td>
                        </tr>
                        <tr>
                            <td><a href="User_Manual_v1.pdf">User_Manual_v1.pdf</a></td>
                            <td>2024-10-22 11:45</td>
                            <td>1.2 MB</td>
                        </tr>
                        <tr>
                            <td><a href="background_dark.png">background_dark.png</a></td>
                            <td>2024-10-20 16:30</td>
                            <td>4.8 MB</td>
                        </tr>
                        <tr>
                            <td><a href="logo.svg">logo.svg</a></td>
                            <td>2024-10-19 10:00</td>
                            <td>12 KB</td>
                        </tr>
                        <tr>
                            <td><a href="promo_video.mp4">promo_video.mp4</a></td>
                            <td>2024-10-18 20:15</td>
                            <td>156 MB</td>
                        </tr>
                        <tr>
                            <td><a href="soundtrack.mp3">soundtrack.mp3</a></td>
                            <td>2024-10-17 14:00</td>
                            <td>8.4 MB</td>
                        </tr>
                        <tr>
                            <td><a href="source_code.zip">source_code.zip</a></td>
                            <td>2024-10-16 09:30</td>
                            <td>24 MB</td>
                        </tr>
                        <tr>
                            <td><a href="app.js">app.js</a></td>
                            <td>2024-10-15 17:45</td>
                            <td>18 KB</td>
                        </tr>
                        <tr>
                            <td><a href="styles.css">styles.css</a></td>
                            <td>2024-10-15 17:30</td>
                            <td>8 KB</td>
                        </tr>
                        <tr>
                            <td><a href="config.json">config.json</a></td>
                            <td>2024-10-14 11:00</td>
                            <td>1.2 KB</td>
                        </tr>
                        <tr>
                            <td><a href="README.md">README.md</a></td>
                            <td>2024-10-13 15:20</td>
                            <td>3.4 KB</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- Card Footer -->
            <div class="fancyui-card-footer">
                <div class="fancyui-card-footer-left">
                    <span>
                        <i data-lucide="cpu"></i>
                        Powered by Nginx
                    </span>
                    <span class="fancyui-footer-dot"></span>
                    <span>FancyIndex Theme</span>
                </div>
                <div class="fancyui-card-footer-right" id="fancyui-timestamp">
                    <!-- Will be populated by JS -->
                </div>
            </div>
        </div>

    </div>

    <script>
        (function () {
            'use strict';

            // Initialize Lucide Icons
            if (typeof lucide !== 'undefined') {
                lucide.createIcons();
            }

            // Theme Toggle
            const themeToggle = document.getElementById('fancyui-theme-toggle');

            if (themeToggle) {
                themeToggle.addEventListener('click', () => {
                    const html = document.documentElement;
                    if (html.classList.contains('dark')) {
                        html.classList.remove('dark');
                        localStorage.setItem('theme', 'light');
                    } else {
                        html.classList.add('dark');
                        localStorage.setItem('theme', 'dark');
                    }
                });
            }

            // Breadcrumb Generation
            function generateBreadcrumb() {
                const h1 = document.querySelector('h1');
                const breadcrumbContainer = document.getElementById('fancyui-breadcrumb');
                if (!h1 || !breadcrumbContainer) return;

                const rawPath = h1.textContent.trim();
                document.title = `Index of ${rawPath}`;

                const parts = rawPath.split('/').filter(p => p);
                breadcrumbContainer.innerHTML = '';

                const rootLink = document.createElement('a');
                rootLink.href = '/';
                rootLink.textContent = 'root';
                breadcrumbContainer.appendChild(rootLink);

                let currentPath = '/';

                parts.forEach((part, index) => {
                    const sep = document.createElement('span');
                    sep.className = 'fancyui-breadcrumb-sep';
                    sep.textContent = '/';
                    breadcrumbContainer.appendChild(sep);

                    currentPath += part + '/';

                    if (index === parts.length - 1) {
                        const current = document.createElement('span');
                        current.className = 'fancyui-breadcrumb-current';
                        current.textContent = part;
                        breadcrumbContainer.appendChild(current);
                    } else {
                        const link = document.createElement('a');
                        link.href = currentPath;
                        link.className = 'fancyui-breadcrumb-inactive';
                        link.textContent = part;
                        breadcrumbContainer.appendChild(link);
                    }
                });
            }

            generateBreadcrumb();

            // Timestamp
            const timestampEl = document.getElementById('fancyui-timestamp');
            if (timestampEl) {
                const now = new Date();
                timestampEl.textContent = `Generated: ${now.toISOString().slice(0, 19).replace('T', ' ')}`;
            }

            // File Icons Enhancement
            const iconMap = {
                'folder': 'folder',
                'jpg': 'image', 'jpeg': 'image', 'png': 'image', 'gif': 'image', 'svg': 'image', 'webp': 'image',
                'mp4': 'video', 'mkv': 'video', 'avi': 'video', 'mov': 'video', 'webm': 'video',
                'mp3': 'music', 'wav': 'music', 'ogg': 'music', 'flac': 'music',
                'zip': 'archive', 'rar': 'archive', '7z': 'archive', 'tar': 'archive', 'gz': 'archive',
                'js': 'file-code', 'ts': 'file-code', 'py': 'file-code', 'css': 'file-code', 'html': 'file-code', 'json': 'file-code',
                'pdf': 'file-text', 'doc': 'file-text', 'docx': 'file-text', 'txt': 'file-text', 'md': 'file-text',
            };

            const iconColorMap = {
                'folder': 'fancyui-icon-folder',
                'image': 'fancyui-icon-image',
                'video': 'fancyui-icon-video',
                'music': 'fancyui-icon-audio',
                'archive': 'fancyui-icon-archive',
                'file-code': 'fancyui-icon-code',
                'file-text': 'fancyui-icon-document',
            };

            function addFileIcons() {
                const rows = document.querySelectorAll('tbody tr');

                rows.forEach(row => {
                    const link = row.querySelector('td:first-child a');
                    if (!link) return;

                    const href = link.getAttribute('href') || '';
                    const text = link.textContent.trim();

                    if (link.querySelector('i, svg, .fancyui-icon')) return;

                    let iconName = 'file';
                    let colorClass = 'fancyui-icon-file';

                    if (href === '../' || href === '..') {
                        const iconWrapper = document.createElement('div');
                        iconWrapper.className = 'fancyui-icon-parent';
                        iconWrapper.innerHTML = '<i data-lucide="arrow-up-left"></i>';
                        link.insertBefore(iconWrapper, link.firstChild);
                        link.style.fontWeight = '600';
                        link.style.color = 'var(--color-accent)';
                    } else if (href.endsWith('/')) {
                        iconName = 'folder';
                        colorClass = 'fancyui-icon-folder';
                        const icon = document.createElement('i');
                        icon.setAttribute('data-lucide', iconName);
                        icon.className = `fancyui-icon ${colorClass}`;
                        link.insertBefore(icon, link.firstChild);
                    } else {
                        const ext = text.split('.').pop().toLowerCase();
                        if (iconMap[ext]) {
                            iconName = iconMap[ext];
                            colorClass = iconColorMap[iconName] || 'fancyui-icon-file';
                        }
                        const icon = document.createElement('i');
                        icon.setAttribute('data-lucide', iconName);
                        icon.className = `fancyui-icon ${colorClass}`;
                        link.insertBefore(icon, link.firstChild);
                    }
                });

                if (typeof lucide !== 'undefined') {
                    lucide.createIcons();
                }
            }

            addFileIcons();

            // Search Functionality
            const searchInput = document.getElementById('fancyui-search');
            const table = document.querySelector('table');

            if (searchInput && table) {
                const tbody = table.querySelector('tbody');
                const allRows = Array.from(tbody.querySelectorAll('tr'));

                let parentRow = null;
                const fileRows = allRows.filter(row => {
                    const link = row.querySelector('a');
                    const href = link ? link.getAttribute('href') : '';
                    if (href === '../' || href === '..') {
                        parentRow = row;
                        return false;
                    }
                    return true;
                });

                searchInput.addEventListener('input', (e) => {
                    const query = e.target.value.toLowerCase().trim();

                    fileRows.forEach(row => {
                        const link = row.querySelector('a');
                        const text = link ? link.textContent.toLowerCase() : '';
                        row.classList.toggle('hidden', query && !text.includes(query));
                    });
                });

                document.addEventListener('keydown', (e) => {
                    if ((e.ctrlKey || e.metaKey) && e.key === 'k') {
                        e.preventDefault();
                        searchInput.focus();
                        searchInput.select();
                    }
                    if (e.key === 'Escape' && document.activeElement === searchInput) {
                        searchInput.value = '';
                        searchInput.dispatchEvent(new Event('input'));
                        searchInput.blur();
                    }
                });
            }

            // Sort Functionality
            const sortButtons = document.querySelectorAll('.fancyui-sort-btn');

            if (sortButtons.length && table) {
                const tbody = table.querySelector('tbody');
                const allRows = Array.from(tbody.querySelectorAll('tr'));

                let parentRow = null;
                const fileRows = allRows.filter(row => {
                    const link = row.querySelector('a');
                    const href = link ? link.getAttribute('href') : '';
                    if (href === '../' || href === '..') {
                        parentRow = row;
                        return false;
                    }
                    return true;
                });

                let currentSort = localStorage.getItem('fancyui-sort') || 'name';
                let sortDir = parseInt(localStorage.getItem('fancyui-sort-dir') || '1');

                function parseSize(str) {
                    if (!str || str === '-' || str === '--') return -1;
                    const match = str.trim().match(/^([\d.]+)\s*([KMGT]?B?)?$/i);
                    if (!match) return 0;
                    const val = parseFloat(match[1]);
                    const unit = (match[2] || 'B').toUpperCase();
                    const units = { 'B': 1, 'K': 1024, 'KB': 1024, 'M': 1048576, 'MB': 1048576, 'G': 1073741824, 'GB': 1073741824 };
                    return val * (units[unit] || 1);
                }

                function parseDate(str) {
                    if (!str || str === '-') return 0;
                    return new Date(str).getTime() || 0;
                }

                function getRowData(row) {
                    const cells = row.querySelectorAll('td');
                    const link = row.querySelector('a');
                    return {
                        name: link ? link.textContent.toLowerCase() : '',
                        isDir: link && link.getAttribute('href').endsWith('/'),
                        date: cells[1] ? parseDate(cells[1].textContent) : 0,
                        size: cells[2] ? parseSize(cells[2].textContent) : 0,
                        el: row
                    };
                }

                function doSort(sortBy, toggle = true) {
                    if (toggle) {
                        if (currentSort === sortBy) {
                            sortDir *= -1;
                        } else {
                            currentSort = sortBy;
                            sortDir = 1;
                        }
                    }

                    localStorage.setItem('fancyui-sort', currentSort);
                    localStorage.setItem('fancyui-sort-dir', sortDir.toString());

                    sortButtons.forEach(btn => btn.classList.toggle('active', btn.dataset.sort === currentSort));

                    const data = fileRows.map(getRowData);

                    data.sort((a, b) => {
                        if (a.isDir !== b.isDir) return a.isDir ? -1 : 1;

                        let cmp = 0;
                        if (currentSort === 'name') cmp = a.name.localeCompare(b.name);
                        else if (currentSort === 'date') cmp = a.date - b.date;
                        else if (currentSort === 'size') cmp = a.size - b.size;

                        return cmp * sortDir;
                    });

                    if (parentRow) tbody.appendChild(parentRow);
                    data.forEach(d => tbody.appendChild(d.el));
                }

                sortButtons.forEach(btn => {
                    btn.addEventListener('click', () => doSort(btn.dataset.sort));
                });

                doSort(currentSort, false);
            }

        })();
    </script>
</body>

</html>